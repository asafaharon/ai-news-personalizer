<!DOCTYPE html>
<html lang="en" data-theme="light" class="smooth-scroll">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Edit Profile • AI News Personalizer</title>
  
  <!-- Tailwind CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  
  <!-- Custom CSS -->
  <link rel="stylesheet" href="/static/style.css" />
  
  <!-- Inter Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Theme Detection -->
  <script>
    if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      document.documentElement.setAttribute('data-theme', 'dark');
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.setAttribute('data-theme', 'light');
      document.documentElement.classList.remove('dark');
    }
  </script>
</head>

<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen font-sans transition-colors duration-300 safe-area-inset-top safe-area-inset-bottom">

  <!-- Header -->
  <header class="bg-white/80 dark:bg-gray-900/80 backdrop-blur-lg border-b border-gray-200 dark:border-gray-700 sticky top-0 z-50 transition-all duration-300">
    <div class="container-responsive">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center space-x-4">
          <div class="w-8 h-8 rounded-lg bg-gradient-to-r from-purple-500 to-pink-600 flex items-center justify-center">
            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
            </svg>
          </div>
          <div>
            <h1 class="text-lg font-semibold text-gray-900 dark:text-white">Edit Profile</h1>
            <p class="text-sm text-gray-500 dark:text-gray-400 hidden md:block">Update your account information</p>
          </div>
        </div>
        
        <div class="flex items-center space-x-4">
          <!-- Theme Toggle -->
          <button id="themeToggle" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors touch-target">
            <svg id="lightIcon" class="w-5 h-5 text-gray-500 dark:text-gray-400 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
            </svg>
            <svg id="darkIcon" class="w-5 h-5 text-gray-500 dark:text-gray-400 block dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
            </svg>
          </button>
          
          <!-- Back to Dashboard -->
          <a href="/dashboard" class="btn btn-secondary px-4 py-2 text-sm interactive touch-target">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
            </svg>
            Dashboard
          </a>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container-responsive py-8 safe-area-inset-left safe-area-inset-right">
    
    <!-- Page Header -->
    <div class="text-center mb-12">
      <div class="w-16 h-16 mx-auto mb-4 rounded-2xl bg-gradient-to-r from-purple-500 to-pink-600 flex items-center justify-center animate-fade-in">
        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
        </svg>
      </div>
      <h1 class="text-3xl md:text-4xl font-bold text-gradient mb-3">Update Your Profile</h1>
      <p class="text-lg text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
        Keep your account information up to date and secure.
      </p>
    </div>

    <!-- Error Message -->
    {% if error %}
    <div class="card p-4 mb-8 bg-red-50 border border-red-200 dark:bg-red-900/20 dark:border-red-800">
      <div class="flex items-center">
        <svg class="w-5 h-5 text-red-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <span class="text-red-800 dark:text-red-200">{{ error }}</span>
      </div>
    </div>
    {% endif %}

    <!-- Profile Form -->
    <div class="max-w-2xl mx-auto">
      <form method="post" action="/profile/edit" id="profileForm" class="space-y-8">
        
        <!-- Personal Information Section -->
        <div class="card p-6 md:p-8">
          <div class="flex items-center mb-6">
            <div class="w-10 h-10 rounded-lg bg-gradient-to-r from-blue-400 to-indigo-500 flex items-center justify-center mr-4">
              <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
              </svg>
            </div>
            <div>
              <h2 class="text-xl font-bold text-gray-900 dark:text-white">Personal Information</h2>
              <p class="text-gray-500 dark:text-gray-400">Update your basic profile details</p>
            </div>
          </div>

          <div class="space-y-6">
            <!-- Full Name -->
            <div>
              <label for="full_name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                Full Name
              </label>
              <div class="relative">
                <input 
                  type="text" 
                  name="full_name" 
                  id="full_name"
                  value="{{ user.name }}" 
                  required
                  placeholder="Enter your full name"
                  class="form-input focus-ring pl-10 touch-target" 
                />
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                  </svg>
                </div>
              </div>
            </div>

            <!-- Email (Read-only) -->
            <div>
              <label for="email" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                Email Address
              </label>
              <div class="relative">
                <input 
                  type="email" 
                  id="email"
                  value="{{ user.email }}" 
                  readonly
                  class="form-input bg-gray-50 dark:bg-gray-700 cursor-not-allowed pl-10 touch-target" 
                />
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207" />
                  </svg>
                </div>
                <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                  <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                  </svg>
                </div>
              </div>
              <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Email address cannot be changed for security reasons</p>
            </div>
          </div>
        </div>

        <!-- Password Section -->
        <div class="card p-6 md:p-8">
          <div class="flex items-center mb-6">
            <div class="w-10 h-10 rounded-lg bg-gradient-to-r from-red-400 to-pink-500 flex items-center justify-center mr-4">
              <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
              </svg>
            </div>
            <div>
              <h2 class="text-xl font-bold text-gray-900 dark:text-white">Security Settings</h2>
              <p class="text-gray-500 dark:text-gray-400">Update your password to keep your account secure</p>
            </div>
          </div>

          <div class="space-y-6">
            <!-- Current Password -->
            <div>
              <label for="current_password" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                Current Password <span class="text-red-500">*</span>
              </label>
              <div class="relative">
                <input 
                  type="password" 
                  name="current_password" 
                  id="current_password"
                  required
                  placeholder="Enter your current password"
                  class="form-input focus-ring pl-10 pr-10 touch-target" 
                />
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                  </svg>
                </div>
                <button type="button" id="toggleCurrentPassword" class="absolute inset-y-0 right-0 pr-3 flex items-center touch-target">
                  <svg id="eyeCurrentOpen" class="h-5 w-5 text-gray-400 hover:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                  </svg>
                  <svg id="eyeCurrentClosed" class="h-5 w-5 text-gray-400 hover:text-gray-600 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L12 12m-2.122-2.122L7.758 7.758M12 12l2.122 2.122m-2.122-2.122L14.122 9.878m-2.122 2.122l2.122 2.122" />
                  </svg>
                </button>
              </div>
            </div>

            <!-- New Password -->
            <div>
              <label for="new_password" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                New Password <span class="text-red-500">*</span>
              </label>
              <div class="relative">
                <input 
                  type="password" 
                  name="new_password" 
                  id="new_password"
                  required
                  placeholder="Enter your new password"
                  class="form-input focus-ring pl-10 pr-10 touch-target" 
                />
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 12H9v4a2 2 0 01-2 2H5v2a2 2 0 01-2 2H2v-2a2 2 0 012-2h2v-4a2 2 0 012-2h2l.257-1.257A6 6 0 0115 7z" />
                  </svg>
                </div>
                <button type="button" id="toggleNewPassword" class="absolute inset-y-0 right-0 pr-3 flex items-center touch-target">
                  <svg id="eyeNewOpen" class="h-5 w-5 text-gray-400 hover:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                  </svg>
                  <svg id="eyeNewClosed" class="h-5 w-5 text-gray-400 hover:text-gray-600 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L12 12m-2.122-2.122L7.758 7.758M12 12l2.122 2.122m-2.122-2.122L14.122 9.878m-2.122 2.122l2.122 2.122" />
                  </svg>
                </button>
              </div>
              
              <!-- Password Strength Indicator -->
              <div class="mt-2">
                <div id="password-strength" class="flex gap-1">
                  <div class="h-1 flex-1 bg-gray-200 dark:bg-gray-700 rounded-full">
                    <div id="strength-bar" class="h-full bg-gray-300 rounded-full transition-all duration-300" style="width: 0%;"></div>
                  </div>
                </div>
                <p id="strength-text" class="text-xs text-gray-500 dark:text-gray-400 mt-1">Enter a new password</p>
              </div>
            </div>

            <!-- Password Tips -->
            <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg">
              <div class="flex items-start">
                <svg class="w-5 h-5 text-blue-500 mt-0.5 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <div class="text-sm">
                  <h4 class="font-medium text-blue-900 dark:text-blue-100 mb-2">Password Requirements:</h4>
                  <ul class="text-blue-800 dark:text-blue-200 space-y-1">
                    <li>• At least 8 characters long</li>
                    <li>• Mix of uppercase and lowercase letters</li>
                    <li>• At least one number</li>
                    <li>• Consider using special characters</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-col md:flex-row gap-4 justify-center items-center">
          <button 
            type="submit" 
            id="saveButton"
            class="btn btn-primary w-full md:w-auto px-8 py-4 text-lg font-semibold focus-ring touch-target"
          >
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            <span id="saveButtonText">Save Changes</span>
            <div id="saveButtonSpinner" class="spinner hidden ml-2"></div>
          </button>
          
          <a href="/dashboard" class="btn btn-secondary w-full md:w-auto px-8 py-4 text-lg font-semibold interactive touch-target">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
            Cancel
          </a>
        </div>
      </form>
    </div>
  </main>

  <!-- Toast Container -->
  <div id="toast-container" class="fixed top-20 right-4 z-40 space-y-2 safe-area-inset-right"></div>

  <!-- Scroll to Top Button -->
  <button id="scrollToTop" class="scroll-to-top" aria-label="Scroll to top">
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
    </svg>
  </button>

  <!-- JavaScript -->
  <script>
    // Theme Toggle Functionality
    const themeToggle = document.getElementById('themeToggle');
    const lightIcon = document.getElementById('lightIcon');
    const darkIcon = document.getElementById('darkIcon');

    themeToggle.addEventListener('click', function() {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      
      document.documentElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      
      if (newTheme === 'dark') {
        document.documentElement.classList.add('dark');
        lightIcon.classList.remove('hidden');
        darkIcon.classList.add('hidden');
      } else {
        document.documentElement.classList.remove('dark');
        lightIcon.classList.add('hidden');
        darkIcon.classList.remove('hidden');
      }
      
      showToast('Theme updated to ' + newTheme + ' mode', 'info');
    });

    // Password Toggle Functionality - Current Password
    document.getElementById('toggleCurrentPassword').addEventListener('click', function() {
      const password = document.getElementById('current_password');
      const eyeOpen = document.getElementById('eyeCurrentOpen');
      const eyeClosed = document.getElementById('eyeCurrentClosed');
      
      if (password.type === 'password') {
        password.type = 'text';
        eyeOpen.classList.add('hidden');
        eyeClosed.classList.remove('hidden');
      } else {
        password.type = 'password';
        eyeOpen.classList.remove('hidden');
        eyeClosed.classList.add('hidden');
      }
    });

    // Password Toggle Functionality - New Password
    document.getElementById('toggleNewPassword').addEventListener('click', function() {
      const password = document.getElementById('new_password');
      const eyeOpen = document.getElementById('eyeNewOpen');
      const eyeClosed = document.getElementById('eyeNewClosed');
      
      if (password.type === 'password') {
        password.type = 'text';
        eyeOpen.classList.add('hidden');
        eyeClosed.classList.remove('hidden');
      } else {
        password.type = 'password';
        eyeOpen.classList.remove('hidden');
        eyeClosed.classList.add('hidden');
      }
    });

    // Password Strength Checker
    document.getElementById('new_password').addEventListener('input', function(e) {
      const password = e.target.value;
      const strengthBar = document.getElementById('strength-bar');
      const strengthText = document.getElementById('strength-text');
      
      let strength = 0;
      let message = '';
      
      if (password.length >= 8) strength += 25;
      if (/[a-z]/.test(password)) strength += 25;
      if (/[A-Z]/.test(password)) strength += 25;
      if (/[0-9]/.test(password)) strength += 25;
      
      strengthBar.style.width = strength + '%';
      
      if (strength === 0) {
        message = 'Enter a new password';
        strengthBar.className = 'h-full bg-gray-300 rounded-full transition-all duration-300';
      } else if (strength <= 50) {
        message = 'Weak password';
        strengthBar.className = 'h-full bg-red-400 rounded-full transition-all duration-300';
      } else if (strength <= 75) {
        message = 'Good password';
        strengthBar.className = 'h-full bg-yellow-400 rounded-full transition-all duration-300';
      } else {
        message = 'Strong password';
        strengthBar.className = 'h-full bg-green-400 rounded-full transition-all duration-300';
      }
      
      strengthText.textContent = message;
    });

    // Form Submission with Loading State
    document.getElementById('profileForm').addEventListener('submit', function() {
      const saveButton = document.getElementById('saveButton');
      const saveButtonText = document.getElementById('saveButtonText');
      const saveButtonSpinner = document.getElementById('saveButtonSpinner');
      
      saveButton.disabled = true;
      saveButton.classList.add('opacity-75');
      saveButtonText.textContent = 'Saving Changes...';
      saveButtonSpinner.classList.remove('hidden');
    });

    // Toast Notification System
    function showToast(message, type = 'info') {
      const toastContainer = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = `toast toast-${type} animate-fade-in`;
      toast.innerHTML = `
        <div class="flex items-center justify-between">
          <span>${message}</span>
          <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
      `;
      
      toastContainer.appendChild(toast);
      
      // Auto remove after 5 seconds
      setTimeout(() => {
        if (toast.parentNode) {
          toast.remove();
        }
      }, 5000);
    }

    // Scroll to Top Functionality
    const scrollToTopBtn = document.getElementById('scrollToTop');
    
    window.addEventListener('scroll', function() {
      if (window.pageYOffset > 300) {
        scrollToTopBtn.classList.add('visible');
      } else {
        scrollToTopBtn.classList.remove('visible');
      }
    });
    
    scrollToTopBtn.addEventListener('click', function() {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    });

    // Enhanced touch support for mobile
    if ('ontouchstart' in window) {
      document.body.classList.add('touch-device');
    }

    // Prevent zoom on input focus (iOS)
    const inputs = document.querySelectorAll('input');
    inputs.forEach(input => {
      input.addEventListener('focus', function() {
        if (window.innerWidth <= 768) {
          document.querySelector('meta[name="viewport"]').setAttribute('content', 'width=device-width, initial-scale=1, maximum-scale=1');
        }
      });
      
      input.addEventListener('blur', function() {
        if (window.innerWidth <= 768) {
          document.querySelector('meta[name="viewport"]').setAttribute('content', 'width=device-width, initial-scale=1.0');
        }
      });
    });

    // Auto-focus first input (desktop only)
    if (window.innerWidth > 768) {
      document.getElementById('full_name').focus();
    }
  </script>

</body>
</html>